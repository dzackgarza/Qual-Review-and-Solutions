# Integration

:::{.definition title="Measurable Function"}
A function $f: (X, \mcm_X) \to (Y, \mcm_Y)$ is **$(\mcm_X, \mcm_Y)\dash$measurable** iff $f\inv(\mcm_Y) \subseteq \mcm_X$.
Equivalently, if $\mce_Y$ is a generating set for $\mcb_Y$, $f\inv(\mce_Y) \subseteq \mcb_X$.

- An functional on a general measurable space $f: f:(X, \mcm_X) \to (\RR, \mcb_\RR)$ is **measurable** $\iff f$ is $(\mcm_X, \mcb_\RR)\dash$measurable.
- A functional $f: \RR^d\to \RR$ is **Borel measurable** iff $f$ is $(\mcb_{\RR^d}, \mcb_\RR)\dash$measurable.
- A functional $f: \RR^d\to \RR$ is **Lebesgue measurable** iff $f$ is $(\mcl_{\RR^d}, \mcb_\RR)\dash$measurable.

Using that $\mcb_{\RR}$ is generated by open/closed rays, it suffices to check any of the following (for all $\alpha \in \RR$):

- $f\inv(\alpha, \infty)\in \mcm$
- $f\inv[\alpha, \infty)\in \mcm$
- $f\inv(-\infty, \alpha)\in \mcm$
- $f\inv(-\infty, \alpha]\in \mcm$
:::

:::{.remark}
Note that we still require Borel sets in the target for Lebesgue measurability!
Taking $(\mcl_{\RR^d}, \mcl_\RR)$ functions is too stringent, e.g. this class does not contain continuous functionals.
:::

:::{.warnings}
If $f$ is $\mcl\dash$measurable and $h$ is continuous, it's not necessarily true that $k\da f\circ h$ is $\mcl\dash$measurable.
Standard counterexample: set $g(x) \da C(x) + x$ for $C$ the Cantor-Lebesgue function, then $g:[0, 1]\to [0, 2]$ is a homeomorphism.
Then $m(g(C)) = 1$ since $f$ is constant on intervals in $C^c$, so use Vitali's theorem: a set is null iff every subset is measurable.
So $g(C)$ contains a non-measurable set $A$.
Define $B\da g\inv(A)$, then $B \subset C$ and $m(C) = 0$ implies $B$ is measurable and $\chi_B$ is a measurable function.
But then $k\da \chi_B \circ g\inv$ is not $\mcl\dash$measurable, since $k\inv(1) = A$ is a non-measurable set, but $\chi_B$ is $\mcl\dash$measurable and $g\inv$ is continuous.
:::

:::{.proposition title="Closure of measurable functions under operations"}
$\mcm\dash$measurable functionals are closed under

- Sums
- Products
- Sups/infs
- Limsups/Liminfs
- Limits when they exist, and the limiting function is measurable.
- $\max(f, g)$ and $\min(f, g)$.

Characteristic functions on measurable sets are automatically measurable, since $E\in \mcm \implies E = \chi_E\inv(\ts{1})$.
:::

:::{.remark title="A common proof technique"}
\envlist

- Show something holds for indicator functions.
- Show it holds for simple functions by linearity.
- Use $s_k \increasesto f$ and apply MCT to show it holds for $f$.
:::

:::{.remark title="on notation"}
\envlist

- $L^+$: nonnegative measurable functions
- $L^1$: Lebesgue integrable functions, so $\int \abs{f} < \infty$
:::

:::{.definition title="Simple Function"}
A **simple function** $s: \CC\to X$ is a finite linear combination of indicator functions of measurable sets, i.e. 
\[
s(x) = \sum_{j=1}^n c_j \chi_{E_j}(x)
.\]
:::

:::{.definition title="Lebesgue Integral"}
\[
\int_X f \da \sup \ts{ \int s(x) \dmu \st 0\leq s \leq f, s\text{ simple } } 
.\]

Note that if $s = \sum c_j \chi_{E_j}$ is simple, then
\[
\int_X s(x) \dmu \da \sum_{j=1}^n c_j \mu(E_j)
.\]

:::

:::{.remark title="Integrals split across disjoint sets"}
A useful fact: for $(X, \mathcal{M})$ a measure space, integrals split across disjoint sets:
\[
\int_X f = \int_{X\sm A} f + \int_A f && \forall\, A \in \mathcal{M} 
.\]

:::

:::{.definition title="Essential supremum and infimum, essentially bounded"}
An **essential lower bound** $b$ on a function $f$ is any real number such that $S_{b} \da \ts{x\st f(x) < b } = f\inv(-\infty, b)$ has measure zero.
The **essential infimum** is the supremum of all essential lower bounds, i.e. $\ess\inf f \da \sup_{b} \ts{b\st \mu S_b = 0}$.
This is the greatest lower bound almost everywhere.

Similarly an **essential upper bound** $c$ is any number such that $S^c \da f\inv(c, \infty)$ has measure zero, and the **essential supremum** is $\ess\sup f \da \inf_{c} \ts{c\st \mu S^c = 0}$, which is the least upper bound almost everywhere.

A function is **essentially bounded** if $\norm{f}_\infty \da \ess\sup f < \infty$.
These are functions which are bounded almost everywhere.
:::

:::{.example title="An essentially bounded but not bounded function"}
$f(x) = x\chi_\QQ(x)$ is essentially bounded but not bounded.
:::

:::{.proposition title="L-infty functions are equivalent to bounded almost-everywhere functions"}
If $f\in L^\infty(X)$, then $f$ is equal to some bounded function $g$ almost everywhere.
:::

:::{.theorem title="p-Test for Integrals"}
\[
\int_0^1 {1\over x^p} < \infty \iff  p < 1 \\
\int_1^\infty {1\over x^p} < \infty \iff  p > 1 
.\]
:::

:::{.slogan}
Large powers of $x$ help us in neighborhoods of infinity and hurt around zero.
:::

:::{.theorem title="Monotone Convergence"}
If $f_n: X\to [0, \infty) \in L^+$ and $f_n \nearrow f$ almost everywhere, then
$$
\lim \int f_n
= \int \lim f_n = \int f
\quad \text{i.e.}~~ \int f_n \to \int f
.$$
:::

:::{.slogan}
Measurable, non-negative, increasing pointwise a.e. allows commuting limits and integrals.
:::

:::{.proof title="of MCT, todo"}
:::

:::{.theorem title="Dominated Convergence"}
If $f_n \in L^1$ and $f_n \to f$ almost everywhere with $\abs {f_n} \leq g$ for some $g\in L^1$, then $f\in L^1$ and
\[
\int \abs{f_n - f} \to 0
.\]

As a consequence,
\[
\lim \int f_n = \int \lim f_n = \int f \quad \text{i.e.}~~ \int f_n \to \int f < \infty
\]

> Positivity *not* needed.

:::

:::{.proof title="of DCT, todo"}
:::

:::{.theorem title="Generalized DCT"}
If 

- $f_n \in L^1$ with $f_n \to f$ almost everywhere, 
- There exist $g_n\geq 0 \in L^1$ nonnegative with $\abs{f_n} \leq g_n$,
- $g_n\to g$ almost everywhere with $g\in L^1$, and 
- $\lim \int g_n = \int g$, 

then $f\in L^1$ and $\lim \int f_n = \int f < \infty$.

> Note that this is the DCT with $\abs{f_n} < \abs{g}$ relaxed to $\abs{f_n} < g_n \to g\in L^1$.

:::

:::{.proof title="of generalized DCT"}
Proceed by showing $\limsup \int f_n \leq \int f \leq \liminf \int f_n$:

- $\int f \geq \limsup \int f_n$:
\[
\int g - \int f 
&= \int \qty{g-f} \\
&\leq \liminf \int \qty{g_n - f_n} \quad \text{Fatou} \\
&= \lim \int g_n + \liminf \int (-f_n) \\
&= \lim \int g_n - \limsup \int f_n \\
&= \int g - \limsup \int f_n \\
\\
\implies \int f &\geq \limsup \int f_n
.\]

  - Here we use $g_n - f_n \converges{n\to\infty}\too g-f$ with $0 \leq \abs{f_n} - f_n \leq g_n - f_n$, so $g_n - f_n$ are nonnegative (and measurable) and Fatou's lemma applies.

- $\int f \leq \liminf \int f_n$:
\[
\int g + \int f 
&= \int(g+f) \\
&\leq \liminf \int \qty{g_n + f_n} \\
&= \lim \int g_n + \liminf \int f_n \\
&= \int g + \liminf f_n \\
\\
\int f &\leq \liminf \int f_n
.\]

  - Here we use that $g_n + f_n \to g+f$ with $0 \leq \abs{f_n} + f_n \leq g_n + f_n$ so Fatou's lemma again applies.
:::

:::{.proposition title="Convergence in $L^1$ implies convergence of norms"}
If $f\in L^1$, then
\[
\int\abs{f_n - f} \to 0 \iff \int \abs{f_n} \to \int \abs{f}
.\]
:::

:::{.proof title="That $L^1$ convergence implies convergence of norms"}
Let $g_n = \abs{f_n} - \abs{f_n - f}$, then $g_n \to \abs{f}$ and 
\[
\abs{g_n} = \abs{ \abs{f_n} - \abs{f_n - f} } \geq \abs{f_n - (f_n - f)} = \abs{f} \in L^1
,\]
so the DCT applies to $g_n$ and
\[
\norm{f_n - f}_1 = \int \abs{f_n - f} + \abs{f_n} - \abs{f_n}
= \int \abs{f_n} - g_n\\
\to_{DCT} \lim \int \abs{f_n} - \int \abs{f}
.\]
:::

:::{.theorem title="Fatou"}
If $f_n$ is a sequence of nonnegative measurable functions, then
\[
\liminf_n \int f_n 
&\geq \int \liminf_n f_n \\
\limsup_n \int f_n &\leq \int \limsup_n f_n
.\]
:::

:::{.proof title="of Fatou"}
\todo[inline]{Prove Fatou}

:::

:::{.theorem title="Tonelli (Non-Negative, Measurable)"}
For $f(x, y)$ **non-negative and measurable**, for almost every $x\in \RR^n$, 

- $f_x(y)$ is a **measurable** function
- $F(x) = \int f(x, y) ~dy$ is a **measurable** function,
- For $E$ measurable, the slices $E_x \definedas \theset{y \suchthat (x, y) \in E}$ are measurable.
- $\int f = \int \int F$, i.e. any iterated integral is equal to the original.
:::

:::{.theorem title="Fubini (Integrable)"}
For $f(x, y)$ **integrable**, for almost every $x\in \RR^n$, 

- $f_x(y)$ is an **integrable** function
- $F(x) \definedas \int f(x, y) ~dy$ is an **integrable** function,
- For $E$ measurable, the slices $E_x \definedas \theset{y \suchthat (x, y) \in E}$ are measurable.
- $\int f = \int \int f(x,y)$, i.e. any iterated integral is equal to the original

:::

:::{.theorem title="Fubini-Tonelli"}
If any iterated integral is **absolutely integrable**, i.e. $\int \int \abs{f(x, y)} < \infty$, then $f$ is integrable and $\int f$ equals any iterated integral.
:::

:::{.proposition title="Differentiating Under an Integral (non-negative)"}
If $\abs{\dd{}{t}f(x, t)} \leq g(x) \in L^1$, then letting $F(t) = \int f(x, t) ~dt$,
\[
\dd{}{t} F(t)
&\definedas \lim_{h \rightarrow 0} \int \frac{f(x, t+h)-f(x, t)}{h} d x \\
&\eq^{\scriptstyle\text{DCT}} \int \dd{}{t} f(x, t) ~dx
.\]

To justify passing the limit, let $h_k \to 0$ be any sequence and define
$$
f_k(x, t) = \frac{f(x, t+h_k)-f(x, t)}{h_k}
,$$
so $f_k \converges{k\to\infty}\too \dd{f}{t}$ pointwise.

Apply the MVT to $f_k$ to get $f_k(x, t) = f_k(\xi, t)$ for some $\xi \in [0, h_k]$, and show that $f_k(\xi, t) \in L_1$.
:::

:::{.proposition title="Commuting Sums with Integrals (non-negative)"}
If $f_n$ are non-negative and $\sum \int \abs f_n < \infty$, then $\sum \int f_n = \int \sum f_n$.
:::

:::{.proof title="Commuting sums with integrals"}
- Idea: MCT. 
- Let $F_N = \sum^N f_n$ be a finite partial sum; 
- Then there are simple functions $\phi_n \nearrow f_n$ 
- So $\sum^N \phi_n \nearrow F_N$ and MCT applies
:::

:::{.theorem title="Commuting Sums with Integrals (integrable)"}
If $\theset{f_n}$ integrable with either $\sum \int \abs{f_n} < \infty$ or $\int\sum \abs{f_n} < \infty$, then
\[  
\int\sum f_n = \sum \int f_n
.\]
:::

:::{.proof title="Commuting sums with integrals (integrable)"}
\envlist

- By Tonelli, if $f_n(x) \geq 0$ for all $n$, taking the counting measure allows interchanging the order of "integration".
- By Fubini on $\abs{f_n}$, if either "iterated integral" is finite then the result follows.
:::

:::{.proposition title="?"}
If $f_k \in L^1$ and $\sum \norm{f_k}_1 < \infty$ then $\sum f_k$ converges almost everywhere and in $L^1$.
:::

:::{.proof title="?"}
Define $F_N = \sum^N f_k$ and $F = \lim_N F_N$, then $\norm{F_N}_1 \leq \sum^N \norm{f_k} < \infty$ so $F\in L^1$ and $\norm{F_N - F}_1 \to 0$ so the sum converges in $L^1$.
Almost everywhere convergence: ?
:::



